<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Snowfall Effect</title>
    <style>
        body { margin: 0; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>
    <video id="video" autoplay style="display:none;"></video>
    <canvas id="canvas"></canvas>
    <button id="capture">拍照</button>
    <img id="photo" alt="Your photo will appear here." style="display:none;"/>

    <script src="https://threejs.org/build/three.js"></script>
    <script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/AR.js"></script>

    <script>
        // 获取视频流
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                const video = document.getElementById('video');
                video.srcObject = stream;
                video.play();
            })
            .catch(err => {
                console.error("Error accessing camera: ", err);
            });

        // 设置 Three.js 场景
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('canvas'), alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        
        // 添加雪花效果
        const snowGeometry = new THREE.Geometry();
        for (let i = 0; i < 1000; i++) {
            const snowflake = new THREE.Vector3(
                Math.random() * 200 - 100,
                Math.random() * 200 - 100,
                Math.random() * 200 - 100
            );
            snowGeometry.vertices.push(snowflake);
        }

        const snowMaterial = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5 });
        const snowflakes = new THREE.Points(snowGeometry, snowMaterial);
        scene.add(snowflakes);

        camera.position.z = 5;

        // 动画渲染
        const animate = function () {
            requestAnimationFrame(animate);
            snowflakes.rotation.y += 0.01;
            renderer.render(scene, camera);
        };
        animate();

        // 拍照功能
        document.getElementById('capture').addEventListener('click', function () {
            const canvas = document.getElementById('canvas');
            const photo = document.getElementById('photo');
            photo.style.display = 'block';
            photo.src = canvas.toDataURL('image/png');
        });
    </script>
</body>
</html>