<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Snow Effect Without Marker</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>
<body>

<a-scene embedded arjs='sourceType: webcam;'>
    <a-entity camera></a-entity>
    <a-entity id="snow" position="0 5 -5" snow></a-entity> <!-- 雪花效果的位置 -->
</a-scene>

<script>
    AFRAME.registerComponent('snow', {
        schema: {
            count: {type: 'int', default: 100}
        },
        init: function () {
            const el = this.el;
            for (let i = 0; i < this.data.count; i++) {
                const snowflake = document.createElement('a-sphere');
                snowflake.setAttribute('radius', Math.random() * 0.02);
                snowflake.setAttribute('position', `${Math.random() * 2 - 1} ${Math.random() * 2 + 5} ${Math.random() * -5}`);
                snowflake.setAttribute('color', '#FFF');
                snowflake.setAttribute('dynamic-body', 'mass: 0'); // 設置為動態物體以便於掉落
                el.appendChild(snowflake);
                this.animateSnowflake(snowflake);
            }
        },
        animateSnowflake: function (snowflake) {
            const fallSpeed = Math.random() * 0.02 + 0.01; // 隨機掉落速度
            const drop = () => {
                let position = snowflake.getAttribute('position');
                position.y -= fallSpeed;
                if (position.y < -1) { // 當雪花掉出視野時重置位置
                    position.y = Math.random() * 5 + 5;
                    position.x = Math.random() * 2 - 1;
                    position.z = Math.random() * -5;
                }
                snowflake.setAttribute('position', position);
                requestAnimationFrame(drop); // 繼續動畫
            };
            drop();
        }
    });

    // 自動開始落雪效果
    document.addEventListener('DOMContentLoaded', function () {
        const snowEntity = document.getElementById('snow');
        snowEntity.setAttribute('snow', 'count: 10000'); // 設定雪花數量
    });
</script>

</body>
</html>
