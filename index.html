<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Snow Effect</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        #captureButton {
            position: absolute;
            top: 10px;
            left: 10px;
            padding: 10px;
            background-color: white;
            border: 1px solid black;
            z-index: 10;
        }
    </style>
</head>
<body>

<button id="captureButton">拍照</button>

<a-scene embedded arjs='sourceType: webcam;'>
    <a-marker preset='hiro'>
        <a-snow></a-snow> <!-- 自定義雪花組件 -->
    </a-marker>
    <a-entity camera></a-entity>
</a-scene>

<script>
    AFRAME.registerComponent('snow', {
        init: function () {
            const el = this.el;
            // 創建雪花效果
            for (let i = 0; i < 100; i++) {
                const snowflake = document.createElement('a-sphere');
                snowflake.setAttribute('radius', Math.random() * 0.02);
                snowflake.setAttribute('position', `${Math.random() * 2 - 1} ${Math.random() * 2 + 1} ${Math.random() * -5}`);
                snowflake.setAttribute('color', '#FFF');
                el.appendChild(snowflake);
            }
        }
    });

    document.getElementById('captureButton').addEventListener('click', function () {
        const scene = document.querySelector('a-scene');
        scene.toDataURL('image/jpeg').then(function (dataUrl) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = 'captured_image.jpg';
            link.click();
        });
    });
</script>

</body>
</html>
